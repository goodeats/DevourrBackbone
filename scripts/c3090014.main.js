"use strict";var App=App||{url:"https://devourapi.herokuapp.com"};App=function(a){return a.addComment=function(){var b=$("#comment-form");b.on("submit",function(c){a.newCommentForm(c,b,router)})},a.newCommentForm=function(b,c,d){b.preventDefault&&b.preventDefault();var e=$(c).find("input[name='comment-body']").val(),f="",g=1;a.newCommentParams(e,f,g,d)},a.newCommentParams=function(a,b,c,d){var e=window.location.hash,f=e.lastIndexOf("/"),g=parseInt(e.substring(f+1,e.length));$.ajax({url:App.url+"/posts/"+g+"/comments",type:"POST",data:{comment:{body:a,picture:b,user_id:c}},complete:function(a,b){},success:function(a,b,c){window.location.reload()},error:function(a,b,c){trace(a,b,c)}}).done(function(a){}).fail(function(a,b,c){trace(a,b,c),d.navigate("posts",{trigger:!0})})},a.deleteComment=function(a){var b=window.location.hash,c=b.lastIndexOf("/"),d=parseInt(b.substring(c+1,b.length));$.ajax({url:App.url+"/posts/"+d+"/comments/"+a,type:"DELETE"}).done(function(){window.location.reload()}).fail(function(){console.log("error: could not delete comment")})},a}(App||{});var App=App||{url:"https://devourapi.herokuapp.com"};App=function(a){return a.getPosts=function(){$container.empty(),$.ajax({url:App.url+"/posts",type:"GET"}).done(function(a){var b=Handlebars.compile($("#postsTemplate").html());$container.html(b({posts:a.posts}));var c=$(".post"),d=$(".fa-heart-o");c.css("width","30%"),App.loadPostsLikes(a),$(".fa-heart").on("click",function(){var a=$(this).attr("id"),b=a.lastIndexOf("-"),c=parseInt(a.substring(b+1,a.length));App.checkIfLiked(c);var d=$(this).parent().children(".statLikes").html(),e=parseInt(d),f=$(this).parent().children(".hiddenLikeCounter").html(),g=parseInt(f);0===g?(g++,$(this).parent().children(".hiddenLikeCounter").text(g)):1===g&&(g--,$(this).parent().children(".hiddenLikeCounter").text(g));var h=function(){if(0===g)var a=e+1;else var a=e-1;return a};$(this).parent().children(".statLikes").text(h());$(this).toggleClass("fa-heart fa-heart-o")}),d.on("click",function(){var a=$(this).attr("id"),b=a.lastIndexOf("-"),c=parseInt(a.substring(b+1,a.length));App.checkIfLiked(c);var d=$(this).parent().children(".statLikes").html(),e=parseInt(d),f=$(this).parent().children(".hiddenLikeCounter").html(),g=parseInt(f);0===g?(g++,$(this).parent().children(".hiddenLikeCounter").text(g)):1===g&&(g--,$(this).parent().children(".hiddenLikeCounter").text(g));var h=function(){if(0===g)var a=e-1;else var a=e+1;return a};$(this).parent().children(".statLikes").text(h());$(this).toggleClass("fa-heart-o fa-heart")})}).fail(function(a,b,c){trace("Backbone posts: fail!",a,b,c)})},a}(App||{});var App=App||{url:"https://devourapi.herokuapp.com"};App=function(a){return a.findPostId=function(){var a=window.location.hash,b=a.lastIndexOf("/");return parseInt(a.substring(b+1,a.length))},a.getPost=function(b){$container.empty(),$.ajax({url:App.url+"/posts/"+b,type:"GET"}).done(function(b){var c=Handlebars.compile($("#postTemplate").html());$container.html(c({post:b.post})),$(".posts").css("width","50%"),$(".posts").css("left","25%");$("#edit-post").on("click",function(){App.editpost(a.findPostId(),b.post)}),$("#delete-post").on("click",function(){var c=window.confirm("Do you want to delete this post?");1==c&&App.deletePost(a.findPostId(),b.post)}),$("#comment-submit").on("click",function(){App.addComment()});var d=$(".deleteComment");d.hide();var e=$(".commentsText");e.mouseenter(function(){var a=$(this).children("p").children("span");trace("parent: "+a.parent()),a.show().on("click",function(){var a=$(this).attr("id"),b=a.lastIndexOf("-"),c=parseInt(a.substring(b+1,a.length));App.deleteComment(c)})}).mouseleave(function(){var a=$(this).children("p").children("span");a.hide()}),App.loadPostLike(b);var f=$(".fa-heart-o");f.on("click",function(){var a=$(this).attr("id"),b=a.lastIndexOf("-"),c=parseInt(a.substring(b+1,a.length));App.checkIfLiked(c);var d=$(this).parent().children(".statLikes").html(),e=parseInt(d),f=$(this).parent().children(".hiddenLikeCounter").html(),g=parseInt(f);0===g?(g++,$(this).parent().children(".hiddenLikeCounter").text(g)):1===g&&(g--,$(this).parent().children(".hiddenLikeCounter").text(g));var h=function(){if(0===g)var a=e-1;else var a=e+1;return a};$(this).parent().children(".statLikes").text(h());$(this).toggleClass("fa-heart-o fa-heart")}),$(".fa-heart").on("click",function(){var a=$(this).attr("id"),b=a.lastIndexOf("-"),c=parseInt(a.substring(b+1,a.length));App.liked(c);var d=$(this).parent().children(".statLikes").html(),d=$(this).parent().children(".statLikes").html(),e=parseInt(d),f=$(this).parent().children(".hiddenLikeCounter").html(),g=parseInt(f);0===g?(g++,$(this).parent().children(".hiddenLikeCounter").text(g)):1===g&&(g--,$(this).parent().children(".hiddenLikeCounter").text(g));var h=function(){if(0===g)var a=e+1;else var a=e-1;return a};$(this).parent().children(".statLikes").text(h());$(this).toggleClass("fa-heart fa-heart-o")})}).fail(function(a,b,c){trace("Backbone post: fail!",a,b,c)})},a.newPost=function(){$("#container").empty().load("partials/new-post-form.html",function(b,c,d){var e=$("#new-post-form");$("#new-post-form").on("submit",function(b){a.newPostForm(b,e,router)})})},a.newPostForm=function(b,c,d){b.preventDefault&&b.preventDefault();var e=c.find("input[name='post-title']").val(),f=c.find("input[name='post-description']").val(),g=c.find("input[name='post-picture']").val(),h=c.find("input[name='post-location']").val(),i=1;a.newPostParams(e,f,g,h,i,d)},a.newPostParams=function(a,b,c,d,e,f){$.ajax({url:App.url+"/posts",type:"POST",data:{post:{title:a,description:b,picture:c,location:d,user_id:e}},complete:function(a,b){},success:function(a,b,c){f.navigate("posts/"+a.post.id,{trigger:!0})},error:function(a,b,c){trace("Backbone newpost: fail",a,b,c)}}).done(function(a){}).fail(function(a,b,c){trace(a,b,c)})},a.editpost=function(b,c){$("#container").empty().load("partials/edit-post-form.html",function(b,d,e){var f=$("#edit-post-form");f.find("input[name='post-title']").val(c.title),f.find("input[name='post-description']").val(c.description),f.find("input[name='post-picture']").val(c.picture),f.find("input[name='post-location']").val(c.location),f.on("submit",function(b,c){a.editPostForm(b,f,router)})})},a.editPostForm=function(b,c,d){var e=window.location.hash,f=e.lastIndexOf("/"),d=parseInt(e.substring(f+1,e.length));b.preventDefault&&b.preventDefault();var g=c.find("input[name='post-title']").val(),h=c.find("input[name='post-description']").val(),i=c.find("input[name='post-picture']").val(),j=c.find("input[name='post-location']").val(),k=1;a.editPostParams(g,h,i,j,k,d,router)},a.editPostParams=function(a,b,c,d,e,f,g){$.ajax({url:App.url+"/posts/"+f,type:"PATCH",data:{post:{title:a,description:b,picture:c,location:d,user_id:e}},complete:function(a,b){},success:function(a,b,c){g.navigate("posts",{trigger:!0})},error:function(a,b,c){trace("Backbone editpost: fail",a,b,c)}}).done(function(a){}).fail(function(a,b,c){trace(a,b,c),g.navigate("failed edit of post",{trigger:!0})})},a.deletePost=function(){var a=window.location.hash,b=a.lastIndexOf("/"),c=parseInt(a.substring(b+1,a.length));$.ajax({url:App.url+"/posts/"+c,type:"DELETE"}).done(function(){router.navigate("posts",{trigger:!0})}).fail(function(){console.log("error: could not delete post")})},a}(App||{}),$(document).ready(function(){});var App=App||{url:"https://devourapi.herokuapp.com"};App=function(a){return a.findUserId=function(){var a=window.location.hash,b=a.lastIndexOf("/");return parseInt(a.substring(b+1,a.length))},a.findUserPostId=function(a){var b=a.attr("id"),c=b.lastIndexOf("-");return parseInt(b.substring(c+1,b.length))},a.findPostLikes=function(a){return parseInt(a.parent().children(".statLikes").html())},a.findHiddenLikeToggle=function(a){return parseInt(a.parent().children(".hiddenLikeCounter").html())},a.hiddenToggleStatus=function(a,b){if(0===a){var c=a++;b.parent().children(".hiddenLikeCounter").text(a)}else if(1===a){var c=a--;b.parent().children(".hiddenLikeCounter").text(a)}return c},a.getUser=function(b){$container.empty(),$.ajax({url:App.url+"/users/"+b,type:"GET"}).done(function(b){var c=Handlebars.compile($("#userTemplate").html());$container.html(c({user:b.user})),$("#edit-user").on("click",function(){var c=a.findUserId(),d=b.user;App.edituser(c,d)});App.loadUserLikes(b);var d=$(".fa-heart-o");d.on("click",function(){var b=a.findUserPostId($(this));App.checkIfLiked(b),$(this).toggleClass("fa-heart-o fa-heart");var c=a.findPostLikes($(this)),d=a.hiddenToggleStatus(a.findHiddenLikeToggle($(this)),$(this)),e=function(){if(0===d)var a=c+1;else var a=c-1;return a};$(this).parent().children(".statLikes").text(e());var f=parseInt($("#statLiked").html()),g=function(){if(0===d)var a=f+1;else var a=f-1;return a};$("#statLiked").text(g())});var e=$(".fa-heart");e.on("click",function(){var b=a.findUserPostId($(this));App.checkIfLiked(b),$(this).toggleClass("fa-heart-o fa-heart");var c=a.findPostLikes($(this)),d=a.hiddenToggleStatus(a.findHiddenLikeToggle($(this)),$(this)),e=function(){if(0===d)var a=c-1;else var a=c+1;return a};$(this).parent().children(".statLikes").text(e());var f=parseInt($("#statLiked").html()),g=function(){if(0===d)var a=f-1;else var a=f+1;return a};$("#statLiked").text(g())})}).fail(function(a,b,c){trace("Backbone user: fail!",a,b,c)})},a.edituser=function(b,c){$("#container").empty().load("partials/edit-user-form.html",function(b,d,e){var f=$("#edit-user-form");f.find("input[name='user-name']").val(c.name),f.find("input[name='user-username']").val(c.username),f.find("input[name='user-avatar']").val(c.avatar),f.find("input[name='user-bio']").val(c.bio),f.find("input[name='user-website']").val(c.website),f.find("input[name='user-location']").val(c.location),f.on("submit",function(b,c){a.editUserForm(b,f,router)})})},a.editUserForm=function(b,c,d){var e=window.location.hash,f=e.lastIndexOf("/"),d=parseInt(e.substring(f+1,e.length));b.preventDefault&&b.preventDefault();var g=c.find("input[name='user-name']").val(),h=c.find("input[name='user-username']").val(),i=c.find("input[name='user-avatar']").val(),j=c.find("input[name='user-bio']").val(),k=c.find("input[name='user-website']").val(),l=c.find("input[name='user-location']").val();a.editUserParams(g,h,i,j,k,l,d,router)},a.editUserParams=function(a,b,c,d,e,f,g,h){$.ajax({url:App.url+"/users/"+g,type:"PATCH",data:{user:{id:g,name:a,username:b,avatar:c,bio:d,website:e,location:f}},complete:function(a,b){},success:function(a,b,c){window.location.reload()},error:function(a,b,c){trace("Backbone edituser: fail",a,b,c)}}).done(function(a){}).fail(function(a,b,c){trace(a,b,c),h.navigate("users/"+g,{trigger:!0})})},a}(App||{}),$(document).ready(function(){});var App=App||{url:"https://devourapi.herokuapp.com"};App=function(a){var b=1;return a.loadPostsLikes=function(a){for(var c=0;c<a.posts.length;c++)a.posts[c].likes.length>0&&jQuery.each(a.posts[c].likes,function(a,c){if(c.user_id===b){var d=$("#like-"+c.post_id);d.replaceWith('<i class="fa fa-heart" id="like-'+c.post_id+'"></i>')}})},a.loadPostLike=function(a){a.post.likes.length>0&&jQuery.each(a.post.likes,function(a,c){if(c.user_id===b){var d=$("#like-"+c.post_id);d.replaceWith('<i class="fa fa-heart" id="like-'+c.post_id+'"></i>')}})},a.loadUserLikes=function(a){for(var c=0;c<a.user.posts.length;c++)a.user.posts[c].likes.length>0&&jQuery.each(a.user.posts[c].likes,function(a,c){if(c.user_id===b){var d=$("#like-"+c.post_id);d.replaceWith('<i class="fa fa-heart" id="like-'+c.post_id+'"></i>')}})},a.checkIfLiked=function(a){$.ajax({url:App.url+"/posts/"+a+"/likes",type:"GET"}).done(function(b){var c=1;if(b.likes.length>0)for(var d=0;d<b.likes.length;d++)b.likes[d].user_id===c&&App.unlike(a,b.likes[d].id);else App.like(a)}).fail(function(){console.log("ERROR!: could not determine if this has been liked yet")})},a.like=function(a){var b=1;$.ajax({url:App.url+"/posts/"+a+"/likes",type:"POST",data:{like:{count:1,post_id:a,user_id:b}}}).done(function(a){console.log("successful like")}).fail(function(a){console.log("like error"+a)})},a.unlike=function(a,b){$.ajax({url:App.url+"/posts/"+a+"/likes/"+b,type:"DELETE"}).done(function(a){console.log("successful unlike")}).fail(function(){console.log("unlike error"+response)})},a}(App||{}),$(document).ready(function(){});var App=App||{url:"https://devourapi.herokuapp.com"};App=function(a){return a.getMyLikes=function(){$container.empty(),$.ajax({url:App.url+"/posts",type:"GET"}).done(function(a){for(var b=Handlebars.compile($("#myLikesTemplate").html()),c=1,d=[],e=0;e<a.posts.length;e++)a.posts[e].likes.length>0&&jQuery.each(a.posts[e].likes,function(f,g){g.user_id===c&&(d.push(a.posts[e]),$container.html(b({posts:d})))});var f=$(".post"),g=$(".fa-heart-o"),c=1;f.css("width","30%"),App.loadPostsLikes(a),$(".fa-heart").on("click",function(){var a=$(this).attr("id"),b=a.lastIndexOf("-"),c=parseInt(a.substring(b+1,a.length));App.checkIfLiked(c);var d=$(this).parent().children(".statLikes").html(),e=parseInt(d),f=$(this).parent().children(".hiddenLikeCounter").html(),g=parseInt(f);0===g?(g++,$(this).parent().children(".hiddenLikeCounter").text(g)):1===g&&(g--,$(this).parent().children(".hiddenLikeCounter").text(g));var h=function(){if(0===g)var a=e+1;else var a=e-1;return a};$(this).parent().children(".statLikes").text(h());$(this).toggleClass("fa-heart fa-heart-o")}),g.on("click",function(){var a=$(this).attr("id"),b=a.lastIndexOf("-"),c=parseInt(a.substring(b+1,a.length));App.checkIfLiked(c);var d=$(this).parent().children(".statLikes").html(),e=parseInt(d),f=$(this).parent().children(".hiddenLikeCounter").html(),g=parseInt(f);0===g?(g++,$(this).parent().children(".hiddenLikeCounter").text(g)):1===g&&(g--,$(this).parent().children(".hiddenLikeCounter").text(g));var h=function(){if(0===g)var a=e-1;else var a=e+1;return a};$(this).parent().children(".statLikes").text(h());$(this).toggleClass("fa-heart-o fa-heart")})}).fail(function(a,b,c){trace("Backbone posts: fail!",a,b,c)})},a}(App||{});var trace=function(){for(var a=0;a<arguments.length;a++)console.log(arguments[a])};trace("Welcome to Devourr!");var App=App||{url:"https://devourapi.herokuapp.com"},$header=$("#header"),$container=$("#container"),Router=Backbone.Router.extend({routes:{"/":"home",home:"home",about:"about","users/:id":"user",posts:"posts","posts/:id":"post","new-post":"newpost",mylikes:"mylikes"},home:function(){$container.empty()},about:function(){$container.empty().load("partials/about.html")},user:function(a){App.getUser(a)},posts:App.getPosts,post:function(a){App.getPost(a)},newpost:function(){App.newPost()},mylikes:function(){App.getMyLikes()}}),setClickHandlers=function(){$("#edit-post").on("click",function(){trace("edit")})},router=new Router;Backbone.history.start(),$(document).ready(function(){$header.empty().load("partials/nav.html"),setClickHandlers()});